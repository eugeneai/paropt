\documentclass[a4paper]{article}
\usepackage[a4paper,margin=2cm]{geometry}
\usepackage[T1]{fontenc}
\usepackage{color}
\usepackage{alltt}
\usepackage{times}
\setlength{\fboxsep}{0pt}
\newcommand{\scitea}[1]{\noindent{\ttfamily{\textcolor[rgb]{0.5, 0.5, 0.5}{\colorbox[rgb]{1.0, 1.0, 1.0}{#1}}}}}
\newcommand{\sciteb}[1]{\noindent{\ttfamily{\textcolor[rgb]{0.0, 0.5, 0.0}{\colorbox[rgb]{1.0, 1.0, 1.0}{#1}}}}}
\newcommand{\scitec}[1]{\noindent{\ttfamily{\textcolor[rgb]{0.0, 0.5, 0.5}{\colorbox[rgb]{1.0, 1.0, 1.0}{#1}}}}}
\newcommand{\scited}[1]{\noindent{\ttfamily{\textcolor[rgb]{0.5, 0.0, 0.5}{\colorbox[rgb]{1.0, 1.0, 1.0}{#1}}}}}
\newcommand{\scitee}[1]{\noindent{\ttfamily{\textcolor[rgb]{0.5, 0.0, 0.5}{\colorbox[rgb]{1.0, 1.0, 1.0}{#1}}}}}
\newcommand{\scitef}[1]{\noindent{\ttfamily{\textbf{\textcolor[rgb]{0.0, 0.0, 0.5}{\colorbox[rgb]{1.0, 1.0, 1.0}{#1}}}}}}
\newcommand{\sciteh}[1]{\noindent{\ttfamily{\textcolor[rgb]{0.5, 0.0, 0.0}{\colorbox[rgb]{1.0, 1.0, 1.0}{#1}}}}}
\newcommand{\scitei}[1]{\noindent{\ttfamily{\textbf{\textcolor[rgb]{0.0, 0.0, 1.0}{\colorbox[rgb]{1.0, 1.0, 1.0}{#1}}}}}}
\newcommand{\scitej}[1]{\noindent{\ttfamily{\textbf{\textcolor[rgb]{0.0, 0.5, 0.5}{\colorbox[rgb]{1.0, 1.0, 1.0}{#1}}}}}}
\newcommand{\scitek}[1]{\noindent{\ttfamily{\textbf{\textcolor[rgb]{0.0, 0.0, 0.0}{\colorbox[rgb]{1.0, 1.0, 1.0}{#1}}}}}}
\newcommand{\scitel}[1]{\noindent{\ttfamily{\textcolor[rgb]{0.0, 0.0, 0.0}{\colorbox[rgb]{1.0, 1.0, 1.0}{#1}}}}}
\newcommand{\sciteib}[1]{\noindent{\ttfamily{\textcolor[rgb]{0.0, 0.0, 0.0}{\colorbox[rgb]{1.0, 1.0, 1.0}{#1}}}}}
\begin{document}

Source File: paropt.py

\newcommand{\myspc}{2pt}

\noindent %

\noindent\small{%
\scitef{import}\scitea{ }\scitel{math}\scitea{} \\
\scitef{import}\scitea{ }\scitel{numpy}\scitek{,}\scitea{ }\scitel{sympy}\scitea{} \\
\scitef{from}\scitea{ }\scitel{numpy}\scitea{ }\scitef{import}\scitea{ }\scitek{*}\scitea{} \\
\scitef{from}\scitea{ }\scitel{functools}\scitea{ }\scitef{import}\scitea{ }\scitel{reduce}\scitea{} \\
\scitef{from}\scitea{ }\scitel{pprint}\scitea{ }\scitef{import}\scitea{ }\scitel{pprint}\scitea{} \\
\scitef{import}\scitea{ }\scitel{itertools}\scitea{} \\
\scitef{from}\scitea{ }\scitel{sympy}\scitea{ }\scitef{import}\scitea{ }\scitel{symbols}\scitek{,}\scitea{ }\scitel{diff}\scitek{,}\scitea{ }\scitel{Symbol}\scitea{} \\
\scitef{import}\scitea{ }\scitel{numpy}\scitek{.}\scitel{linalg}\scitea{} \\
\scitef{import}\scitea{ }\scitel{unittest}\scitea{} \\
\scitef{from}\scitea{ }\scitel{sympy}\scitek{.}\scitel{utilities}\scitek{.}\scitel{lambdify}\scitea{ }\scitef{import}\scitea{ }\scitel{lambdify}\scitea{} \\
\scitef{import}\scitea{ }\scitel{os}\scitea{} \\
\scitea{} \\
\scitel{TupleType}\scitek{=}\scitel{type}\scitek{((}\scitec{1}\scitek{,))}\scitea{} \\
\scitel{ListType}\scitek{=}\scitel{type}\scitek{([])}\scitea{} \\
\scitea{} \\
\scitea{} \\
\scitel{DEBUG}\scitea{ }\scitek{=}\scitea{ }\scitec{20}\scitea{} \\
\sciteb{\#DEBUG = 0}\scitea{} \\
\scitel{PROFILE}\scitea{ }\scitek{=}\scitea{ }\scitel{False}\scitea{ }\sciteb{\# True}\scitea{} \\
\sciteb{\#Ht = 0.01}\scitea{} \\
\scitel{Ht}\scitea{ }\scitek{=}\scitea{ }\scitec{0.2}\scitea{} \\
\scitef{import}\scitea{ }\scitel{time}\scitea{} \\
\scitea{} \\
\scitef{class}\scitea{ }\scitei{Helper}\scitek{():}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{pass}\scitea{} \\
\scitea{} \\
\scitef{class}\scitea{ }\scitei{VFCalc}\scitek{(}\scitel{object}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{""" Class automizing differential convertions of} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} vector-functions.} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{\_\_init\_\_}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{N}\scitek{,}\scitel{M}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{"""} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{N}\scitek{=}\scitel{N}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{M}\scitek{=}\scitel{M}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{v}\scitek{=}\scitel{Helper}\scitek{()}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{v}\scitek{.}\scitel{x}\scitek{=[}\scitel{Symbol}\scitek{(}\scitee{'x'}\scitek{+}\scitel{str}\scitek{(}\scitel{i}\scitek{+}\scitec{1}\scitek{))}\scitea{ }\scitef{for}\scitea{ }\scitel{i}\scitea{ }\scitef{in}\scitea{ }\scitel{range}\scitek{(}\scitel{self}\scitek{.}\scitel{N}\scitek{)]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{v}\scitek{.}\scitel{u}\scitek{=[}\scitel{Symbol}\scitek{(}\scitee{'u'}\scitek{+}\scitel{str}\scitek{(}\scitel{i}\scitek{+}\scitec{1}\scitek{))}\scitea{ }\scitef{for}\scitea{ }\scitel{i}\scitea{ }\scitef{in}\scitea{ }\scitel{range}\scitek{(}\scitel{self}\scitek{.}\scitel{M}\scitek{)]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{v}\scitek{.}\scitel{t}\scitek{=}\scitel{Symbol}\scitek{(}\scitee{'t'}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{diff1}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{f}\scitek{,}\scitea{ }\scitel{var}\scitek{):}\sciteb{\# derivation of one vector-variable}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{"""This is method for figuring out of} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} functional differentials of vector-variable lists} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitel{type}\scitek{(}\scitel{f}\scitek{)}\scitea{ }\scitef{in}\scitea{ }\scitek{[}\scitel{TupleType}\scitek{,}\scitel{ListType}\scitek{]:}\scitea{ }\sciteb{\#f myght be a tuple(n-ka)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{df}\scitek{=}\scitel{tuple}\scitek{([}\scitel{self}\scitek{.}\scitel{diff1}\scitek{(}\scitel{fi}\scitek{,}\scitea{ }\scitel{var}\scitek{)}\scitea{ }\scitef{for}\scitea{ }\scitel{fi}\scitea{ }\scitef{in}\scitea{ }\scitel{f}\scitek{])}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{else}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{df}\scitek{=}\scitel{tuple}\scitek{([}\scitel{diff}\scitek{(}\scitel{f}\scitek{,}\scitea{ }\scitel{vi}\scitek{)}\scitea{ }\scitef{for}\scitea{ }\scitel{vi}\scitea{ }\scitef{in}\scitea{ }\scitel{var}\scitek{])}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitel{len}\scitek{(}\scitel{df}\scitek{)==}\scitec{1}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{df}\scitek{=}\scitel{df}\scitek{[}\scitec{0}\scitek{]}\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\# Original f is not a tuple or a list (!)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{df}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{diff}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{f}\scitek{,}\scitea{ }\scitek{*}\scitel{vars}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{"""This is method for figuring out of} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} functional differentials of vector-variable lists} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{cf}\scitek{=}\scitel{f}\sciteb{\#current func}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{for}\scitea{ }\scitel{v}\scitea{ }\scitef{in}\scitea{ }\scitel{vars}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{cf}\scitek{=}\scitel{self}\scitek{.}\scitel{diff1}\scitek{(}\scitel{cf}\scitek{,}\scitea{ }\scitel{v}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{cf}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{subs}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{f}\scitek{,}\scitea{ }\scitel{s}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitel{type}\scitek{(}\scitel{f}\scitek{)}\scitea{ }\scitef{not}\scitea{ }\scitef{in}\scitea{ }\scitek{[}\scitel{TupleType}\scitek{,}\scitel{ListType}\scitek{]:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{f}\scitek{.}\scitel{subs}\scitek{(}\scitel{s}\scitek{)}\scitea{ }\sciteb{\# common subs}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{tuple}\scitek{([}\scitel{self}\scitek{.}\scitel{subs}\scitek{(}\scitel{fi}\scitek{,}\scitel{s}\scitek{)}\scitea{ }\scitef{for}\scitea{ }\scitel{fi}\scitea{ }\scitef{in}\scitea{ }\scitel{f}\scitek{])}\sciteb{\#local subs}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{lambdify}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{f}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{"""Compiles function f into a lambda-function} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} with args as its arguments.} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{l}\scitek{=[}\scitel{self}\scitek{.}\scitel{v}\scitek{.}\scitel{t}\scitek{]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{l}\scitek{.}\scitel{extend}\scitek{(}\scitel{self}\scitek{.}\scitel{v}\scitek{.}\scitel{x}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{l}\scitek{.}\scitel{extend}\scitek{(}\scitel{self}\scitek{.}\scitel{v}\scitek{.}\scitel{u}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\# print (l)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{fl}\scitek{=}\scitel{lambdify}\scitek{(}\scitel{l}\scitek{,}\scitea{ }\scitel{f}\scitek{,}\scitea{ }\scited{"numpy"}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{fl}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{code}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{f}\scitek{,}\scitea{ }\scitek{*}\scitel{vars}\scitek{,}\scitea{ }\scitel{debug}\scitek{=}\scitel{False}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{df}\scitek{=}\scitel{self}\scitek{.}\scitel{diff}\scitek{(}\scitel{f}\scitek{,}\scitea{ }\scitek{*}\scitel{vars}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{c}\scitek{=}\scitel{self}\scitek{.}\scitel{lambdify}\scitek{(}\scitel{df}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitel{debug}\scitek{:}\scitea{ }\scitef{return}\scitea{ }\scitel{c}\scitek{,}\scitea{ }\scitel{df}\scitek{,}\scitea{ }\scitel{f}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{c}\scitek{,}\scitel{df}\scitea{} \\
\scitea{} \\
\scitea{} \\
\scitef{class}\scitea{ }\scitei{Model}\scitek{(}\scitel{object}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{"""Parametric Optimised model class.} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} See docs for individual methods on usage ways.} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{\_\_init\_\_}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{X0}\scitek{,}\scitea{ }\scitel{U0}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{X0}\scitek{=}\scitel{array}\scitek{(}\scitel{X0}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{U0}\scitek{=}\scitel{U0}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{N}\scitek{=}\scitel{self}\scitek{.}\scitel{X0}\scitek{.}\scitel{shape}\scitek{[}\scitec{0}\scitek{]}\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\# Dimention of X}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{M}\scitek{=}\scitel{U0}\scitek{.}\scitel{shape}\scitek{[}\scitec{1}\scitek{]}\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\# Dimention of U}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scitee{'X0:'}\scitek{,}\scitea{ }\scitel{X0}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scitee{'U0:'}\scitek{,}\scitea{ }\scitel{U0}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{F}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{x}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{"""x is the ending state of a trajectory} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitec{0.0}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{f}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{t}\scitek{,}\scitea{ }\scitel{x}\scitek{,}\scitea{ }\scitel{U}\scitek{,}\scitea{ }\scitel{dt}\scitek{=}\scitec{1}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{raise}\scitea{ }\scitel{RuntimeError}\scitek{(}\scited{"should be implemented by subclass"}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{f0}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{t}\scitek{,}\scitea{ }\scitel{x}\scitek{,}\scitea{ }\scitel{u}\scitek{,}\scitea{ }\scitel{dt}\scitek{=}\scitec{1}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitec{0.0}\scitea{} \\
\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#------------ These functions must be defined for Second Order Improvement Process -----}\scitea{} \\
\scitea{} \\
\scitea{} \\
\scitef{class}\scitea{ }\scitei{Process}\scitek{(}\scitel{VFCalc}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{"""This calss corresponds to a optimizational model.} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{\_\_init\_\_}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{model}\scitek{,}\scitea{ }\scitel{alpha}\scitek{=}\scitec{1.0}\scitek{,}\scitea{ }\scitel{beta}\scitek{=}\scitec{1.0}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{"""} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{VFCalc}\scitek{.}\scitel{\_\_init\_\_}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{model}\scitek{.}\scitel{N}\scitek{,}\scitea{ }\scitel{model}\scitek{.}\scitel{M}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{t}\scitek{,}\scitel{x}\scitek{,}\scitel{u}\scitek{=}\scitel{self}\scitek{.}\scitel{v}\scitek{.}\scitel{t}\scitek{,}\scitel{self}\scitek{.}\scitel{v}\scitek{.}\scitel{x}\scitek{,}\scitel{self}\scitek{.}\scitel{v}\scitek{.}\scitel{u}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{model}\scitek{=}\scitel{model}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{v}\scitek{.}\scitel{f}\scitek{=}\scitel{model}\scitek{.}\scitel{f}\scitek{(}\scitel{t}\scitek{,}\scitea{ }\scitel{x}\scitek{,}\scitea{ }\scitel{u}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{v}\scitek{.}\scitel{f0}\scitek{=}\scitel{model}\scitek{.}\scitel{f0}\scitek{(}\scitel{t}\scitek{,}\scitea{ }\scitel{x}\scitek{,}\scitea{ }\scitel{u}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{v}\scitek{.}\scitel{F}\scitek{=}\scitel{model}\scitek{.}\scitel{F}\scitek{(}\scitel{x}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{alpha}\scitek{=}\scitel{alpha}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{beta}\scitek{=}\scitel{beta}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{optimize}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{t}\scitek{,}\scitea{ }\scitel{eps}\scitek{=}\scitec{0.001}\scitek{,}\scitea{ }\scitel{iters}\scitek{=}\scitec{1000}\scitek{):}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Up}\scitek{=}\scitel{self}\scitek{.}\scitel{model}\scitek{.}\scitel{U0}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Xp}\scitek{=}\scitel{self}\scitek{.}\scitel{trajectory}\scitek{(}\scitel{Up}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Ip}\scitek{=}\scitel{self}\scitek{.}\scitel{I}\scitek{(}\scitel{Xp}\scitek{,}\scitel{Up}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{it}\scitea{ }\scitek{=}\scitea{ }\scitec{1}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{while}\scitea{ }\scitel{True}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{beta}\scitea{ }\scitek{=}\scitea{ }\scitel{self}\scitek{.}\scitel{beta}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Psi}\scitek{=}\scitel{self}\scitek{.}\scitel{Psi}\scitek{(}\scitel{t}\scitek{,}\scitea{ }\scitel{Xp}\scitek{,}\scitea{ }\scitel{Up}\scitek{,}\scitea{ }\scitel{self}\scitek{.}\scitel{alpha}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{\_H\_u}\scitek{=}\scitel{self}\scitek{.}\scitel{H}\scitek{((}\scitel{self}\scitek{.}\scitel{v}\scitek{.}\scitel{u}\scitek{,),}\scitea{ }\scitel{t}\scitek{[:-}\scitec{1}\scitek{],}\scitea{ }\scitel{Xp}\scitek{[:-}\scitec{1}\scitek{],}\scitea{ }\scitel{Up}\scitek{,}\scitea{ }\scitel{Psi}\scitek{,}\scitea{ }\scitel{alpha}\scitek{=}\scitec{1.0}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{while}\scitea{ }\scitel{True}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scitel{it}\scitek{,}\scitea{ }\scitel{beta}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{\_dU}\scitek{=}\scitel{\_H\_u}\scitek{*}\scitel{beta}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Un}\scitea{ }\scitek{=}\scitea{ }\scitel{Up}\scitea{ }\scitek{+}\scitea{ }\scitel{\_dU}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Xn}\scitea{ }\scitek{=}\scitea{ }\scitel{self}\scitek{.}\scitel{trajectory}\scitek{(}\scitel{Un}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{In}\scitea{ }\scitek{=}\scitea{ }\scitel{self}\scitek{.}\scitel{I}\scitek{(}\scitel{Xn}\scitek{,}\scitea{ }\scitel{Un}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{dI}\scitea{ }\scitek{=}\scitea{ }\scitel{Ip}\scitek{-}\scitel{In}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitel{DEBUG}\scitek{$>$}\scitec{5}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scited{"DI:"}\scitek{,}\scitea{ }\scitel{dI}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitel{DEBUG}\scitek{$>$}\scitec{6}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scited{"Xn:"}\scitek{,}\scitea{ }\scitel{Xn}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scited{"Un:"}\scitek{,}\scitea{ }\scitel{Un}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitel{abs}\scitek{(}\scitel{dI}\scitek{)$<$}\scitel{eps}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{In}\scitek{,}\scitea{ }\scitel{Xn}\scitek{,}\scitea{ }\scitel{Un}\scitek{,}\scitea{ }\scitel{it}\scitek{,}\scitea{ }\scited{"Opt"}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitel{iters}\scitek{$<$=}\scitec{0}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{In}\scitek{,}\scitea{ }\scitel{Xn}\scitek{,}\scitea{ }\scitel{Un}\scitek{,}\scitea{ }\scitel{it}\scitek{,}\scitea{ }\scited{"Nonoptimal"}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{iters}\scitek{-=}\scitec{1}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{it}\scitek{+=}\scitec{1}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitel{In}\scitek{$>$=}\scitel{Ip}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{beta}\scitek{/=}\scitec{2}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{continue}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{else}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Xp}\scitek{,}\scitea{ }\scitel{Up}\scitek{,}\scitea{ }\scitel{Ip}\scitea{ }\scitek{=}\scitea{ }\scitel{Xn}\scitek{,}\scitea{ }\scitel{Un}\scitek{,}\scitea{ }\scitel{In}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{break}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{raise}\scitea{ }\scitel{RuntimeError}\scitek{(}\scited{"this should be not reached"}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{trajectory}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{U}\scitek{):}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{x0}\scitek{=}\scitel{self}\scitek{.}\scitel{model}\scitek{.}\scitel{X0}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{X}\scitea{ }\scitek{=}\scitea{ }\scitek{[}\scitel{x0}\scitek{]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{for}\scitea{ }\scitel{t}\scitek{,}\scitea{ }\scitel{u}\scitea{ }\scitef{in}\scitea{ }\scitel{enumerate}\scitek{(}\scitel{U}\scitek{):}\scitea{ }\sciteb{\# (0, u0), (1, u1)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{xn}\scitek{=}\scitel{self}\scitek{.}\scitel{model}\scitek{.}\scitel{f}\scitek{(}\scitel{t}\scitek{,}\scitea{ }\scitel{X}\scitek{[}\scitel{t}\scitek{],}\scitea{ }\scitel{u}\scitek{)}\scitea{ }\sciteb{\# FIXME: implement via code}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{X}\scitek{.}\scitel{append}\scitek{(}\scitel{xn}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{array}\scitek{(}\scitel{X}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{I}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{X}\scitek{,}\scitea{ }\scitel{U}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{\_add}\scitek{(}\scitel{acc}\scitek{,}\scitea{ }\scitel{t}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{acc}\scitea{ }\scitek{+}\scitea{ }\scitel{self}\scitek{.}\scitel{model}\scitek{.}\scitel{f0}\scitek{(}\scitel{t}\scitek{,}\scitea{ }\scitel{X}\scitek{[}\scitel{t}\scitek{],}\scitea{ }\scitel{U}\scitek{[}\scitel{t}\scitek{])}\scitea{ }\sciteb{\# FIXME: implement via code}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{reduce}\scitek{(}\scitel{\_add}\scitek{,}\scitea{ }\scitel{range}\scitek{(}\scitel{len}\scitek{(}\scitel{X}\scitek{)-}\scitec{1}\scitek{),}\scitea{ }\scitel{self}\scitek{.}\scitel{model}\scitek{.}\scitel{F}\scitek{(}\scitel{X}\scitek{[-}\scitec{1}\scitek{]))}\scitea{ }\sciteb{\# FIXME: implement via code}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{Psi}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{t}\scitek{,}\scitea{ }\scitel{X}\scitek{,}\scitea{ }\scitel{U}\scitek{,}\scitea{ }\scitel{alpha}\scitek{):}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{v}\scitek{=}\scitel{self}\scitek{.}\scitel{v}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\# import pudb; pu.db}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scitel{v}\scitek{.}\scitel{F}\scitek{,}\scitea{ }\scitel{X}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scited{"-------"}\scitek{,}\scitea{ }\scitel{t}\scitek{[-}\scitec{1}\scitek{],}\scitea{ }\scitel{X}\scitek{[-}\scitec{1}\scitek{],}\scitea{ }\scitel{U}\scitek{[-}\scitec{1}\scitek{])}\scitea{} \\
\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{psie}\scitea{ }\scitek{=}\scitea{ }\scitek{-}\scitel{self}\scitek{.}\scitel{fun}\scitek{(}\scitel{v}\scitek{.}\scitel{F}\scitek{,(}\scitel{v}\scitek{.}\scitel{x}\scitek{,),}\scitea{ }\scitel{t}\scitek{[-}\scitec{1}\scitek{],}\scitea{ }\scitel{X}\scitek{[-}\scitec{1}\scitek{],}\scitea{ }\scitel{U}\scitek{[-}\scitec{1}\scitek{])}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{psi}\scitek{=[}\scitel{psie}\scitek{]}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#for the rest of the interval}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{X}\scitek{=}\scitel{X}\scitek{[:-}\scitec{1}\scitek{]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{t}\scitek{=}\scitel{t}\scitek{[:-}\scitec{1}\scitek{]}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{\_f0\_x}\scitek{=}\scitel{self}\scitek{.}\scitel{fun}\scitek{(}\scitel{v}\scitek{.}\scitel{f0}\scitek{,}\scitea{ }\scitek{(}\scitel{v}\scitek{.}\scitel{x}\scitek{,),}\scitea{ }\scitel{t}\scitek{,}\scitea{ }\scitel{X}\scitek{,}\scitea{ }\scitel{U}\scitek{)}\scitea{ }\sciteb{\# last element is useless}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{\_f\_x}\scitea{ }\scitek{=}\scitel{self}\scitek{.}\scitel{fun}\scitek{(}\scitel{v}\scitek{.}\scitel{f}\scitek{,}\scitea{ }\scitek{(}\scitel{v}\scitek{.}\scitel{x}\scitek{,),}\scitea{ }\scitel{t}\scitek{,}\scitea{ }\scitel{X}\scitek{,}\scitea{ }\scitel{U}\scitek{)}\scitea{ }\sciteb{\# last element is useless}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{j}\scitek{=}\scitel{len}\scitek{(}\scitel{t}\scitek{)-}\scitec{1}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{p}\scitek{=}\scitel{psie}\scitea{} \\
\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{while}\scitea{ }\scitel{j}\scitek{$>$=}\scitec{1}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{i}\scitek{=}\scitel{t}\scitek{[}\scitel{j}\scitek{]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{pp}\scitek{=}\scitel{p}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{\_f\_x\_i}\scitea{ }\scitek{=}\scitea{ }\scitel{\_f\_x}\scitek{[}\scitel{i}\scitek{]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#\_f0\_x\_t = transpose(\_f0\_x[i])}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{pn}\scitea{ }\scitek{=}\scitea{ }\scitel{dot}\scitek{(}\scitel{pp}\scitek{,}\scitel{\_f\_x\_i}\scitek{)}\scitea{ }\scitek{-}\scitea{ }\scitel{alpha}\scitek{*}\scitel{\_f0\_x}\scitek{[}\scitel{i}\scitek{]}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#if j==1:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} print (\_f\_x\_t, pp, \_f0\_x\_t, "=$>$", pn )}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} print (self.v[[0.4*x0], [0.4*x1]].f0\_x)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{psi}\scitek{.}\scitel{append}\scitek{(}\scitel{pn}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{p}\scitek{=}\scitel{pn}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{j}\scitek{-=}\scitec{1}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\# ----}\scitea{} \\
\scitea{} \\
\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{psi}\scitek{=}\scitel{array}\scitek{(}\scitel{psi}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#return array([psi[::-1]]).T}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{psi}\scitek{[::-}\scitec{1}\scitek{]}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{krot\_d\_dd}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{t}\scitek{,}\scitea{ }\scitel{X}\scitek{,}\scitea{ }\scitel{U}\scitek{,}\scitea{ }\scitel{alpha}\scitek{=}\scitec{1.0}\scitek{):}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Psi}\scitek{=}\scitel{self}\scitek{.}\scitel{Psi}\scitek{(}\scitel{t}\scitek{,}\scitea{ }\scitel{X}\scitek{,}\scitea{ }\scitel{U}\scitek{,}\scitea{ }\scitel{alpha}\scitek{=}\scitel{alpha}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{v}\scitek{=}\scitel{self}\scitek{.}\scitel{v}\scitea{} \\
\scitea{} \\
\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{sige}\scitea{{\hspace*{\myspc}} }\scitek{=}\scitea{ }\scitek{-}\scitel{self}\scitek{.}\scitel{fun}\scitek{(}\scitel{v}\scitek{.}\scitel{F}\scitek{,}\scitea{ }\scitek{(}\scitel{v}\scitek{.}\scitel{x}\scitek{,}\scitel{v}\scitek{.}\scitel{x}\scitek{),}\scitea{ }\scitel{t}\scitek{[-}\scitec{1}\scitek{],}\scitea{ }\scitel{X}\scitek{[-}\scitec{1}\scitek{],}\scitea{ }\scitel{U}\scitek{[-}\scitec{1}\scitek{])}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Sig}\scitek{=[}\scitel{sige}\scitek{]}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#for the rest of the interval}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{X}\scitek{=}\scitel{X}\scitek{[:-}\scitec{1}\scitek{]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{t}\scitek{=}\scitel{t}\scitek{[:-}\scitec{1}\scitek{]}\scitea{} \\
\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{H\_x\_x}\scitek{=}\scitel{self}\scitek{.}\scitel{H}\scitek{((}\scitel{v}\scitek{.}\scitel{x}\scitek{,}\scitel{v}\scitek{.}\scitel{x}\scitek{),}\scitea{ }\scitel{t}\scitek{,}\scitea{ }\scitel{X}\scitek{,}\scitel{U}\scitek{,}\scitea{ }\scitel{Psi}\scitek{,}\scitea{ }\scitel{alpha}\scitek{=}\scitel{alpha}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{\_f0\_x}\scitek{=}\scitel{self}\scitek{.}\scitel{fun}\scitek{(}\scitel{v}\scitek{.}\scitel{f0}\scitek{,}\scitea{ }\scitek{(}\scitel{v}\scitek{.}\scitel{x}\scitek{,),}\scitea{ }\scitel{t}\scitek{,}\scitel{X}\scitek{,}\scitel{U}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{\_f\_x}\scitea{ }\scitek{=}\scitel{self}\scitek{.}\scitel{fun}\scitek{(}\scitel{v}\scitek{.}\scitel{f}\scitek{,}\scitea{ }\scitek{(}\scitel{v}\scitek{.}\scitel{x}\scitek{,),}\scitea{ }\scitel{t}\scitek{,}\scitea{ }\scitel{X}\scitek{,}\scitea{ }\scitel{U}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{\_f0\_x\_x}\scitek{=}\scitel{self}\scitek{.}\scitel{fun}\scitek{(}\scitel{v}\scitek{.}\scitel{f0}\scitek{,}\scitea{ }\scitek{(}\scitel{v}\scitek{.}\scitel{x}\scitek{,}\scitel{v}\scitek{.}\scitel{x}\scitek{),}\scitea{ }\scitel{t}\scitek{,}\scitea{ }\scitel{X}\scitek{,}\scitea{ }\scitel{U}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{\_f\_x\_x}\scitek{=}\scitel{self}\scitek{.}\scitel{fun}\scitek{(}\scitel{v}\scitek{.}\scitel{f}\scitek{,}\scitea{ }\scitek{(}\scitel{v}\scitek{.}\scitel{x}\scitek{,}\scitel{v}\scitek{.}\scitel{x}\scitek{),}\scitea{ }\scitel{t}\scitek{,}\scitea{ }\scitel{X}\scitek{,}\scitea{ }\scitel{U}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{j}\scitek{=}\scitel{len}\scitek{(}\scitel{t}\scitek{)-}\scitec{1}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{sp}\scitek{=}\scitel{sige}\scitea{} \\
\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{while}\scitea{ }\scitel{j}\scitek{$>$=}\scitec{1}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{i}\scitek{=}\scitel{t}\scitek{[}\scitel{j}\scitek{]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{\_f\_x\_i}\scitea{ }\scitek{=}\scitea{ }\scitel{\_f\_x}\scitek{[}\scitel{i}\scitek{]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{\_f\_x\_t}\scitea{ }\scitek{=}\scitea{ }\scitel{transpose}\scitek{(}\scitel{\_f\_x\_i}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{pn}\scitea{ }\scitek{=}\scitea{ }\scitel{Psi}\scitek{[}\scitel{i}\scitek{]}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{H\_x\_x\_i}\scitea{ }\scitek{=}\scitea{ }\scitel{H\_x\_x}\scitek{[}\scitel{i}\scitek{]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{sn}\scitea{ }\scitek{=}\scitea{ }\scitel{dot}\scitek{(}\scitel{dot}\scitek{(}\scitel{sp}\scitek{,}\scitel{\_f\_x\_i}\scitek{),}\scitea{ }\scitel{\_f\_x\_i}\scitek{)}\scitea{ }\scitek{+}\scitea{ }\scitel{H\_x\_x\_i}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Sig}\scitek{.}\scitel{append}\scitek{(}\scitel{sn}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{sp}\scitek{=}\scitel{sn}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{j}\scitek{-=}\scitec{1}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Sig}\scitek{=}\scitel{array}\scitek{(}\scitel{Sig}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{Psi}\scitek{,}\scitea{ }\scitel{Sig}\scitek{[::-}\scitec{1}\scitek{]}\scitea{ }\sciteb{\# Really it is dPsidalpha}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\# Really it is dSigmadalpha}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{fun}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{f}\scitek{,}\scitea{ }\scitel{vars}\scitek{,}\scitea{ }\scitel{T}\scitek{,}\scitea{ }\scitel{X}\scitek{,}\scitea{ }\scitel{U}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\# evaluate derivatives of f on vars and substitute t, X,U}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{code}\scitek{,}\scitel{df}\scitek{=}\scitel{self}\scitek{.}\scitel{code}\scitek{(}\scitel{f}\scitek{,}\scitea{ }\scitek{*}\scitel{vars}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#T=numpy.atleast\_1d(T)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{X}\scitek{=}\scitel{numpy}\scitek{.}\scitel{atleast\_1d}\scitek{(}\scitel{X}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{U}\scitek{=}\scitel{numpy}\scitek{.}\scitel{atleast\_1d}\scitek{(}\scitel{U}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitel{X}\scitek{.}\scitel{ndim}\scitek{$>$}\scitec{1}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Xs}\scitek{=[}\scitel{X}\scitek{[:,}\scitel{i}\scitek{:}\scitel{i}\scitek{+}\scitec{1}\scitek{]}\scitea{ }\scitef{for}\scitea{ }\scitel{i}\scitea{ }\scitef{in}\scitea{ }\scitel{range}\scitek{(}\scitel{X}\scitek{.}\scitel{shape}\scitek{[}\scitec{1}\scitek{])]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Us}\scitek{=[}\scitel{U}\scitek{[:,}\scitel{i}\scitek{:}\scitel{i}\scitek{+}\scitec{1}\scitek{]}\scitea{ }\scitef{for}\scitea{ }\scitel{i}\scitea{ }\scitef{in}\scitea{ }\scitel{range}\scitek{(}\scitel{U}\scitek{.}\scitel{shape}\scitek{[}\scitec{1}\scitek{])]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{m}\scitek{,}\scitel{args}\scitek{=}\scitel{True}\scitek{,(}\scitel{T}\scitek{,)+}\scitel{tuple}\scitek{(}\scitel{Xs}\scitek{+}\scitel{Us}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{else}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{m}\scitek{,}\scitel{args}\scitek{=}\scitel{False}\scitek{,(}\scitel{T}\scitek{,)+}\scitel{tuple}\scitek{(}\scitel{X}\scitek{)+}\scitel{tuple}\scitek{(}\scitel{U}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{rc}\scitek{=}\scitel{code}\scitek{(*}\scitel{args}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{rct}\scitek{=}\scitel{type}\scitek{(}\scitel{rc}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{import}\scitea{ }\scitel{pdb}\scitek{;}\scitea{ }\scitel{pdb}\scitek{.}\scitel{set\_trace}\scitek{()}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{rc}\scitek{=}\scitel{numpy}\scitek{.}\scitel{atleast\_1d}\scitek{(}\scitel{rc}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitel{type}\scitek{(}\scitel{T}\scitek{)==}\scitel{numpy}\scitek{.}\scitel{ndarray}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{dm}\scitek{=}\scitel{False}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{try}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitel{rct}\scitea{ }\scitef{in}\scitea{ }\scitek{[}\scitel{TupleType}\scitek{,}\scitel{ListType}\scitek{]:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{rc}\scitek{=}\scitel{rc}\scitek{.}\scitel{reshape}\scitek{(}\scitel{rc}\scitek{.}\scitel{shape}\scitek{[:-}\scitec{1}\scitek{])}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{rc}\scitek{=}\scitel{rc}\scitek{.}\scitel{T}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{rc}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{except}\scitea{ }\scitel{ValueError}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{pass}\scitea{} \\
\sciteb{\#{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} if rct!=numpy.ndarray:}\scitea{} \\
\sciteb{\#{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} dm=(1,) \# ???}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitel{T}\scitek{.}\scitel{shape}\scitek{[}\scitec{0}\scitek{]!=}\scitel{rc}\scitek{.}\scitel{shape}\scitek{[}\scitec{0}\scitek{]:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{dm}\scitek{=}\scitel{rc}\scitek{.}\scitel{shape}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitel{dm}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{nff}\scitek{=}\scitel{numpy}\scitek{.}\scitel{zeros}\scitek{((}\scitel{len}\scitek{(}\scitel{T}\scitek{),)+}\scitel{dm}\scitek{,}\scitel{dtype}\scitek{=}\scitel{float}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{nff}\scitek{[:]=}\scitel{rc}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{rc}\scitek{=}\scitel{nff}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{rc}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{H}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{vars}\scitek{,}\scitea{ }\scitel{T}\scitek{,}\scitea{ }\scitel{X}\scitek{,}\scitea{ }\scitel{U}\scitek{,}\scitea{ }\scitel{Psi}\scitek{,}\scitea{ }\scitel{alpha}\scitea{ }\scitek{=}\scitea{ }\scitec{1.0}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\# calculate H\_v\_v...(t.}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\# print ("Evaluating H:", vars, len(T), len(X), len(U), len(Psi))}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{assert}\scitea{ }\scitel{len}\scitek{(}\scitel{vars}\scitek{)$>$}\scitec{0}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{assert}\scitea{ }\scitel{len}\scitek{(}\scitel{T}\scitek{)}\scitea{ }\scitek{==}\scitea{ }\scitel{len}\scitek{(}\scitel{X}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{assert}\scitea{ }\scitel{len}\scitek{(}\scitel{X}\scitek{)==}\scitel{len}\scitek{(}\scitel{U}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{assert}\scitea{ }\scitel{len}\scitek{(}\scitel{U}\scitek{)==}\scitel{len}\scitek{(}\scitel{Psi}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{f}\scitek{=}\scitel{self}\scitek{.}\scitel{fun}\scitek{(}\scitel{self}\scitek{.}\scitel{v}\scitek{.}\scitel{f}\scitek{,}\scitea{ }\scitel{vars}\scitek{,}\scitea{ }\scitel{T}\scitek{,}\scitea{ }\scitel{X}\scitek{,}\scitea{ }\scitel{U}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{f0}\scitek{=-}\scitel{self}\scitek{.}\scitel{fun}\scitek{(}\scitel{self}\scitek{.}\scitel{v}\scitek{.}\scitel{f0}\scitek{,}\scitea{ }\scitel{vars}\scitek{,}\scitea{ }\scitel{T}\scitek{,}\scitea{ }\scitel{X}\scitek{,}\scitea{ }\scitel{U}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{H}\scitea{ }\scitek{=}\scitea{ }\scitel{alpha}\scitea{ }\scitek{*}\scitea{ }\scitel{f0}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{for}\scitea{ }\scitel{psi}\scitek{,}\scitel{\_H}\scitek{,}\scitel{\_f}\scitek{,}\scitel{i}\scitea{ }\scitef{in}\scitea{ }\scitel{zip}\scitek{(}\scitel{Psi}\scitek{,}\scitea{ }\scitel{H}\scitek{,}\scitea{ }\scitel{f}\scitek{,}\scitea{ }\scitel{range}\scitek{(}\scitel{len}\scitek{(}\scitel{H}\scitek{))):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{\_H}\scitea{ }\scitek{+=}\scitea{ }\scitel{dot}\scitek{(}\scitel{psi}\scitek{,}\scitel{\_f}\scitek{)}\scitea{ }\sciteb{\# !}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{H}\scitek{[}\scitel{i}\scitek{]=}\scitel{\_H}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{H}\scitea{} \\
\scitea{} \\
\scitef{class}\scitea{ }\scitei{SeconOrderProcess}\scitek{(}\scitel{Process}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{"""A second order parametric optimization process} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{\_\_init\_\_}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{model}\scitek{,}\scitea{ }\scitek{**}\scitel{kwargs}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{X0}\scitek{=}\scitel{array}\scitek{([}\scitec{0.0}\scitek{,}\scitea{ }\scitec{0.0}\scitek{])}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{t}\scitea{ }\scitek{=}\scitea{ }\scitel{arange}\scitek{(}\scitec{2}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Process}\scitek{.}\scitel{\_\_init\_\_}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{model}\scitek{,}\scitea{ }\scitek{**}\scitel{kwargs}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{time\_transpose}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{a}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\# the axis 0 mist be conserved, other axes reversed.}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{ash}\scitek{=}\scitel{len}\scitek{(}\scitel{a}\scitek{.}\scitel{shape}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{a1}\scitek{=}\scitel{range}\scitek{(}\scitel{ash}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{a2}\scitek{=}\scitel{list}\scitek{(}\scitel{a1}\scitek{[}\scitec{1}\scitek{:])}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{a2}\scitek{.}\scitel{reverse}\scitek{()}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{axes}\scitek{=(}\scitec{0}\scitek{,)+}\scitel{tuple}\scitek{(}\scitel{a2}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{numpy}\scitek{.}\scitel{transpose}\scitek{(}\scitel{a}\scitek{,}\scitel{axes}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{optimize}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{t}\scitek{,}\scitea{ }\scitel{eps}\scitek{=}\scitec{0.001}\scitek{,}\scitea{ }\scitel{iters}\scitek{=}\scitec{1000}\scitek{,}\scitea{ }\scitel{alpha}\scitek{=}\scitel{None}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Up}\scitek{=}\scitel{self}\scitek{.}\scitel{model}\scitek{.}\scitel{start\_control}\scitek{()}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Xp}\scitek{=}\scitel{self}\scitek{.}\scitel{trajectory}\scitek{(}\scitel{Up}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Ip}\scitek{=}\scitel{self}\scitek{.}\scitel{I}\scitek{(}\scitel{Xp}\scitek{,}\scitel{Up}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{v}\scitek{=}\scitel{self}\scitek{.}\scitel{v}\scitea{} \\
\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{it}\scitea{ }\scitek{=}\scitea{ }\scitec{1}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{tc}\scitea{ }\scitek{=}\scitel{t}\scitek{[:-}\scitec{1}\scitek{]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Xpc}\scitek{=}\scitel{Xp}\scitek{[:-}\scitec{1}\scitek{]}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{E}\scitek{=}\scitel{numpy}\scitek{.}\scitel{identity}\scitek{(}\scitel{self}\scitek{.}\scitel{model}\scitek{.}\scitel{M}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitel{alpha}\scitek{==}\scitel{None}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{\_a}\scitek{=}\scitel{self}\scitek{.}\scitel{alpha}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{else}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{\_a}\scitek{=}\scitel{alpha}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{while}\scitea{ }\scitel{True}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\# Something done with alphas and}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Psi}\scitek{,}\scitea{ }\scitel{Sigma}\scitea{ }\scitek{=}\scitea{ }\scitel{self}\scitek{.}\scitel{krot\_d\_dd}\scitek{(}\scitel{t}\scitek{,}\scitea{ }\scitel{Xp}\scitek{,}\scitea{ }\scitel{Up}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{\_f\_u}\scitek{=}\scitel{self}\scitek{.}\scitel{fun}\scitek{(}\scitel{v}\scitek{.}\scitel{f}\scitek{,}\scitea{ }\scitek{(}\scitel{v}\scitek{.}\scitel{u}\scitek{,),}\scitea{ }\scitel{tc}\scitek{,}\scitea{ }\scitel{Xpc}\scitek{,}\scitea{ }\scitel{Up}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{\_f\_u\_t}\scitek{=}\scitel{self}\scitek{.}\scitel{time\_transpose}\scitek{(}\scitel{\_f\_u}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{\_f\_x}\scitek{=}\scitel{self}\scitek{.}\scitel{fun}\scitek{(}\scitel{v}\scitek{.}\scitel{f}\scitek{,}\scitea{ }\scitek{(}\scitel{v}\scitek{.}\scitel{x}\scitek{,),}\scitea{ }\scitel{tc}\scitek{,}\scitea{ }\scitel{Xpc}\scitek{,}\scitea{ }\scitel{Up}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{\_f\_x\_t}\scitek{=}\scitel{self}\scitek{.}\scitel{time\_transpose}\scitek{(}\scitel{\_f\_x}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{\_f\_u\_u}\scitek{=}\scitel{self}\scitek{.}\scitel{fun}\scitek{(}\scitel{v}\scitek{.}\scitel{f}\scitek{,(}\scitel{v}\scitek{.}\scitel{u}\scitek{,}\scitel{v}\scitek{.}\scitel{u}\scitek{),}\scitea{ }\scitel{tc}\scitek{,}\scitea{ }\scitel{Xpc}\scitek{,}\scitea{ }\scitel{Up}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{alpha}\scitek{=}\scitel{\_a}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{while}\scitea{ }\scitel{True}\scitek{:}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#import pudb; pu.db}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{f\_part}\scitek{=}\scitel{self}\scitek{.}\scitel{H}\scitek{((}\scitel{v}\scitek{.}\scitel{u}\scitek{,}\scitel{v}\scitek{.}\scitel{u}\scitek{),}\scitea{ }\scitel{tc}\scitek{,}\scitea{ }\scitel{Xpc}\scitek{,}\scitea{ }\scitel{Up}\scitek{,}\scitea{ }\scitel{Psi}\scitek{,}\scitea{ }\scitel{alpha}\scitek{=}\scitel{alpha}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{for}\scitea{ }\scitel{h}\scitek{,}\scitea{ }\scitel{fut}\scitek{,}\scitea{ }\scitel{fu}\scitek{,}\scitea{ }\scitel{sik}\scitek{,}\scitea{ }\scitel{k}\scitea{ }\scitef{in}\scitea{ }\scitel{zip}\scitek{(}\scitel{f\_part}\scitek{,}\scitea{ }\scitel{\_f\_u\_t}\scitek{,}\scitea{ }\scitel{\_f\_u}\scitek{,}\scitea{ }\scitel{Sigma}\scitek{,}\scitea{ }\scitel{range}\scitek{(}\scitel{len}\scitek{(}\scitel{f\_part}\scitek{))):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{h}\scitek{+=}\scitel{dot}\scitek{(}\scitel{dot}\scitek{(}\scitel{fut}\scitek{,}\scitea{ }\scitel{alpha}\scitek{*}\scitel{sik}\scitek{),}\scitel{fu}\scitek{)-}\scitel{E}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{f\_part}\scitek{[}\scitel{k}\scitek{]=-}\scitel{linalg}\scitek{.}\scitel{inv}\scitek{(}\scitel{h}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{s\_part}\scitek{=}\scitel{self}\scitek{.}\scitel{H}\scitek{((}\scitel{v}\scitek{.}\scitel{u}\scitek{,}\scitel{v}\scitek{.}\scitel{x}\scitek{),}\scitea{ }\scitel{tc}\scitek{,}\scitea{ }\scitel{Xpc}\scitek{,}\scitea{ }\scitel{Up}\scitek{,}\scitea{ }\scitel{Psi}\scitek{,}\scitea{ }\scitel{alpha}\scitek{=}\scitel{alpha}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{for}\scitea{ }\scitel{h}\scitek{,}\scitea{ }\scitel{fxt}\scitek{,}\scitea{ }\scitel{sik}\scitek{,}\scitea{ }\scitel{fu}\scitea{ }\scitef{in}\scitea{ }\scitel{zip}\scitek{(}\scitel{s\_part}\scitek{,}\scitea{ }\scitel{\_f\_x\_t}\scitek{,}\scitea{ }\scitel{Sigma}\scitek{,}\scitea{ }\scitel{\_f\_u}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{s\_part}\scitek{[}\scitel{k}\scitek{]+=}\scitel{dot}\scitek{(}\scitel{dot}\scitek{(}\scitel{fxt}\scitek{,}\scitea{ }\scitel{alpha}\scitek{*}\scitel{sik}\scitek{),}\scitel{fu}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{H\_u}\scitek{=}\scitel{H\_u\_a}\scitek{=}\scitel{self}\scitek{.}\scitel{H}\scitek{((}\scitel{v}\scitek{.}\scitel{u}\scitek{,),}\scitea{ }\scitel{tc}\scitek{,}\scitea{ }\scitel{Xpc}\scitek{,}\scitel{Up}\scitek{,}\scitea{ }\scitel{Psi}\scitek{,}\scitea{ }\scitel{alpha}\scitek{=}\scitel{alpha}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Un}\scitea{ }\scitek{=}\scitea{ }\scitel{numpy}\scitek{.}\scitel{copy}\scitek{(}\scitel{Up}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#dU = numpy.copy(Up)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Xn}\scitea{ }\scitek{=}\scitea{ }\scitel{numpy}\scitek{.}\scitel{copy}\scitek{(}\scitel{Xp}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#dX = numpy.copy(Xp)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Xn}\scitek{[}\scitec{0}\scitek{]=}\scitel{Xp}\scitek{[}\scitec{0}\scitek{]}\scitea{ }\sciteb{\# In reality it is already copied.}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Xn\_i}\scitek{=}\scitel{Xp}\scitek{[}\scitec{0}\scitek{]}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{for}\scitea{ }\scitel{i}\scitek{,}\scitea{ }\scitel{psi}\scitea{ }\scitef{in}\scitea{ }\scitel{enumerate}\scitek{(}\scitel{Psi}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Xp\_i}\scitek{=}\scitel{Xp}\scitek{[}\scitel{i}\scitek{]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Up\_i}\scitek{=}\scitel{Up}\scitek{[}\scitel{i}\scitek{]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{H\_u\_i}\scitek{=}\scitel{H\_u}\scitek{[}\scitel{i}\scitek{]}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{dX\_i}\scitek{=}\scitel{Xn\_i}\scitek{-}\scitel{Xp\_i}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#dU\_i=dot((H\_u\_a[i]+dot(dX\_i,s\_part[i])),f\_part[i])}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#dU\_i=dot(H\_u\_a[i],f\_part[i])}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{dU\_i}\scitek{=}\scitel{H\_u\_a}\scitek{[}\scitel{i}\scitek{]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Un\_i}\scitea{ }\scitek{=}\scitea{ }\scitel{Up\_i}\scitea{ }\scitek{+}\scitea{ }\scitel{dUn\_i}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Xnn\_i}\scitek{=}\scitel{self}\scitek{.}\scitel{model}\scitek{.}\scitel{f}\scitek{(}\scitel{t}\scitek{[}\scitel{i}\scitek{],}\scitea{ }\scitel{Xn\_i}\scitek{,}\scitea{ }\scitel{Un\_i}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Un}\scitek{[}\scitel{i}\scitek{]=}\scitel{Un\_i}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Xn}\scitek{[}\scitel{i}\scitek{+}\scitec{1}\scitek{]=}\scitel{Xnn\_i}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Xn\_i}\scitek{=}\scitel{Xnn\_i}\scitea{} \\
\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{In}\scitea{ }\scitek{=}\scitea{ }\scitel{self}\scitek{.}\scitel{I}\scitek{(}\scitel{Xn}\scitek{,}\scitea{ }\scitel{Un}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{dI}\scitea{ }\scitek{=}\scitea{ }\scitel{Ip}\scitek{-}\scitel{In}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitel{DEBUG}\scitek{$>$=}\scitec{0}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scited{"Ip:"}\scitek{,}\scitea{ }\scitel{Ip}\scitek{,}\scitea{ }\scited{"In:"}\scitek{,}\scitea{ }\scitel{In}\scitek{,}\scitea{{\hspace*{\myspc}} }\scited{"DI:"}\scitek{,}\scitea{ }\scitel{dI}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitel{abs}\scitek{(}\scitel{dI}\scitek{)$<$}\scitel{eps}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{In}\scitek{,}\scitea{ }\scitel{Xn}\scitek{,}\scitea{ }\scitel{Un}\scitek{,}\scitea{ }\scitel{it}\scitek{,}\scitea{ }\scited{"Opt"}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitel{iters}\scitek{$<$=}\scitec{0}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{In}\scitek{,}\scitea{ }\scitel{Xn}\scitek{,}\scitea{ }\scitel{Un}\scitek{,}\scitea{ }\scitel{it}\scitek{,}\scitea{ }\scited{"Nonoptimal"}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{iters}\scitek{-=}\scitec{1}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{it}\scitek{+=}\scitec{1}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitel{In}\scitek{$>$}\scitel{Ip}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{alpha}\scitek{*=}\scitec{0.7}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{continue}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{else}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Xp}\scitek{,}\scitea{ }\scitel{Up}\scitek{,}\scitea{ }\scitel{Ip}\scitea{ }\scitek{=}\scitea{ }\scitel{Xn}\scitek{,}\scitea{ }\scitel{Un}\scitek{,}\scitea{ }\scitel{In}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{break}\scitea{} \\
\scitea{} \\
\sciteb{\# -------------------- tests -------------------------------------------------}\scitea{} \\
\scitea{} \\
\scitef{class}\scitea{ }\scitei{LinModel1}\scitek{(}\scitel{Model}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{"""Possibly simple linear test model.} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{\_\_init\_\_}\scitek{(}\scitel{self}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{X0}\scitek{=(}\scitec{1.0}\scitek{,)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{h}\scitea{ }\scitek{=}\scitea{ }\scitel{Ht}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\# self.h = 0.001}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\# self.h = 0.2}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{num}\scitea{ }\scitek{=}\scitea{ }\scitel{int}\scitek{((}\scitec{1.0}\scitek{-}\scitec{0.0}\scitek{)}\scitea{ }\scitek{/}\scitea{ }\scitel{self}\scitek{.}\scitel{h}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{T}\scitea{ }\scitek{=}\scitea{ }\scitel{linspace}\scitek{(}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{start}\scitek{=}\scitec{0.0}\scitek{,}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{stop}\scitek{=}\scitec{1.0}\scitek{,}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{num}\scitek{=}\scitel{self}\scitek{.}\scitel{num}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{t}\scitea{ }\scitek{=}\scitea{ }\scitel{arange}\scitek{(}\scitel{len}\scitek{(}\scitel{self}\scitek{.}\scitel{T}\scitek{))}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Model}\scitek{.}\scitel{\_\_init\_\_}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{X0}\scitek{=}\scitel{X0}\scitek{,}\scitea{ }\scitel{U0}\scitek{=}\scitel{self}\scitek{.}\scitel{start\_control}\scitek{())}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{start\_control}\scitek{(}\scitel{self}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{U}\scitea{ }\scitek{=}\scitea{ }\scitek{[(}\scitec{0.0}\scitek{,)}\scitea{ }\scitef{for}\scitea{ }\scitel{t}\scitea{ }\scitef{in}\scitea{ }\scitel{self}\scitek{.}\scitel{t}\scitek{[:-}\scitec{1}\scitek{]]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{array}\scitek{(}\scitel{U}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{F}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{x}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{""" X and U are lists of vectors (arrays)} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitec{0.0}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{f}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{t}\scitek{,}\scitea{ }\scitel{x}\scitek{,}\scitea{ }\scitel{u}\scitek{,}\scitea{ }\scitel{dt}\scitek{=}\scitec{1}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{""" X ia a vector of the previous state} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{x0}\scitek{=}\scitel{x}\scitek{[}\scitec{0}\scitek{]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{u0}\scitek{=}\scitel{u}\scitek{[}\scitec{0}\scitek{]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitek{(}\scitel{x0}\scitek{+}\scitel{self}\scitek{.}\scitel{h}\scitek{*}\scitel{u0}\scitek{,)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{f0}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{t}\scitek{,}\scitea{ }\scitel{x}\scitek{,}\scitea{ }\scitel{u}\scitek{,}\scitea{ }\scitel{dt}\scitek{=}\scitec{1}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{""" X ia a vector of the previous state} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{x0}\scitek{=}\scitel{x}\scitek{[}\scitec{0}\scitek{]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{u0}\scitek{=}\scitel{u}\scitek{[}\scitec{0}\scitek{]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{self}\scitek{.}\scitel{h}\scitea{ }\scitek{*}\scitea{ }\scitek{(}\scitel{x0}\scitek{*}\scitel{x0}\scitek{+}\scitel{u0}\scitek{*}\scitel{u0}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{} \\
\scitef{class}\scitea{ }\scitei{LinModel2d2du}\scitek{(}\scitel{Model}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{"""Possibly not a simple linear test model.} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{\_\_init\_\_}\scitek{(}\scitel{self}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{X0}\scitek{=(}\scitec{1.0}\scitek{,}\scitec{1.0}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{h}\scitea{ }\scitek{=}\scitea{ }\scitel{Ht}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{num}\scitea{ }\scitek{=}\scitea{ }\scitel{int}\scitek{((}\scitec{1.0}\scitek{-}\scitec{0.0}\scitek{)}\scitea{ }\scitek{/}\scitea{ }\scitel{self}\scitek{.}\scitel{h}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{T}\scitea{ }\scitek{=}\scitea{ }\scitel{linspace}\scitek{(}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{start}\scitek{=}\scitec{0.0}\scitek{,}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{stop}\scitek{=}\scitec{1.0}\scitek{,}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{num}\scitek{=}\scitel{self}\scitek{.}\scitel{num}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{t}\scitea{ }\scitek{=}\scitea{ }\scitel{arange}\scitek{(}\scitel{len}\scitek{(}\scitel{self}\scitek{.}\scitel{T}\scitek{))}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Model}\scitek{.}\scitel{\_\_init\_\_}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{X0}\scitek{=}\scitel{X0}\scitek{,}\scitea{ }\scitel{U0}\scitek{=}\scitel{self}\scitek{.}\scitel{start\_control}\scitek{())}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{start\_control}\scitek{(}\scitel{self}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{U}\scitea{ }\scitek{=}\scitea{ }\scitek{[[}\scitec{0.0}\scitek{,}\scitec{0.0}\scitek{]}\scitea{ }\scitef{for}\scitea{ }\scitel{t}\scitea{ }\scitef{in}\scitea{ }\scitel{self}\scitek{.}\scitel{t}\scitek{[:-}\scitec{1}\scitek{]]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{array}\scitek{(}\scitel{U}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{F}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{x}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{""" X and U are lists of vectors (arrays)} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitec{0.0}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{f}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{t}\scitek{,}\scitea{ }\scitel{x}\scitek{,}\scitea{ }\scitel{u}\scitek{,}\scitea{ }\scitel{dt}\scitek{=}\scitec{1}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{""" X ia a vector of the previous state} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitek{(}\scitel{x0}\scitek{,}\scitel{x1}\scitek{)=}\scitel{x}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitek{(}\scitel{u0}\scitek{,}\scitel{u1}\scitek{)=}\scitel{u}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitek{(}\scitel{x0}\scitek{+}\scitel{self}\scitek{.}\scitel{h}\scitek{*}\scitel{u0}\scitek{,}\scitea{ }\scitel{x1}\scitek{+}\scitel{self}\scitek{.}\scitel{h}\scitek{*}\scitel{u1}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{f0}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{t}\scitek{,}\scitea{ }\scitel{x}\scitek{,}\scitea{ }\scitel{u}\scitek{,}\scitea{ }\scitel{dt}\scitek{=}\scitec{1}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{""" X ia a vector of the previous state} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitek{(}\scitel{x0}\scitek{,}\scitel{x1}\scitek{)=}\scitel{x}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitek{(}\scitel{u0}\scitek{,}\scitel{u1}\scitek{)=}\scitel{u}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{self}\scitek{.}\scitel{h}\scitea{ }\scitek{*}\scitea{ }\scitek{(}\scitel{x0}\scitek{*}\scitel{x0}\scitek{+}\scitel{x1}\scitek{*}\scitel{x1}\scitek{+}\scitel{u0}\scitek{*}\scitel{u0}\scitek{+}\scitel{u1}\scitek{*}\scitel{u1}\scitek{)}\scitea{} \\
\scitea{} \\
\scitef{class}\scitea{ }\scitei{LinModel2d2du1}\scitek{(}\scitel{Model}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{"""Possibly not a simple linear test model.} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{\_\_init\_\_}\scitek{(}\scitel{self}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{X0}\scitek{=}\scitel{array}\scitek{([[}\scitec{1.0}\scitek{],[}\scitec{1.0}\scitek{]])}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{h}\scitea{ }\scitek{=}\scitea{ }\scitel{Ht}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{num}\scitea{ }\scitek{=}\scitea{ }\scitel{int}\scitek{((}\scitec{1.0}\scitek{-}\scitec{0.0}\scitek{)}\scitea{ }\scitek{/}\scitea{ }\scitel{self}\scitek{.}\scitel{h}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{T}\scitea{ }\scitek{=}\scitea{ }\scitel{linspace}\scitek{(}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{start}\scitek{=}\scitec{0.0}\scitek{,}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{stop}\scitek{=}\scitec{1.0}\scitek{,}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{num}\scitek{=}\scitel{self}\scitek{.}\scitel{num}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{self}\scitek{.}\scitel{t}\scitea{ }\scitek{=}\scitea{ }\scitel{arange}\scitek{(}\scitel{len}\scitek{(}\scitel{self}\scitek{.}\scitel{T}\scitek{))}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{Model}\scitek{.}\scitel{\_\_init\_\_}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{X0}\scitek{=}\scitel{X0}\scitek{,}\scitea{ }\scitel{U0}\scitek{=}\scitel{self}\scitek{.}\scitel{start\_control}\scitek{())}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{start\_control}\scitek{(}\scitel{self}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{U}\scitea{ }\scitek{=}\scitea{ }\scitek{[}\scitel{array}\scitek{([[}\scitec{0.0}\scitek{],[}\scitec{0.0}\scitek{]])}\scitea{ }\scitef{for}\scitea{ }\scitel{t}\scitea{ }\scitef{in}\scitea{ }\scitel{self}\scitek{.}\scitel{t}\scitek{[:-}\scitec{1}\scitek{]]}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{array}\scitek{(}\scitel{U}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{F}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{x}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{""" X and U are lists of vectors (arrays)} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitec{0.0}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{f}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{t}\scitek{,}\scitea{ }\scitel{x}\scitek{,}\scitea{ }\scitel{u}\scitek{,}\scitea{ }\scitel{dt}\scitek{=}\scitec{1}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{""" X ia a vector of the previous state} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitek{((}\scitel{x0}\scitek{,),(}\scitel{x1}\scitek{,))=}\scitel{x}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitek{((}\scitel{u0}\scitek{,),(}\scitel{u1}\scitek{,))=}\scitel{u}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitek{((}\scitel{x0}\scitek{**}\scitec{5}\scitek{+}\scitel{self}\scitek{.}\scitel{h}\scitek{*}\scitel{u0}\scitek{,),(}\scitel{x1}\scitek{**}\scitec{5}\scitek{+}\scitel{self}\scitek{.}\scitel{h}\scitek{*}\scitel{u1}\scitek{,))}\scitea{} \\
\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{def}\scitea{ }\scitej{f0}\scitek{(}\scitel{self}\scitek{,}\scitea{ }\scitel{t}\scitek{,}\scitea{ }\scitel{x}\scitek{,}\scitea{ }\scitel{u}\scitek{,}\scitea{ }\scitel{dt}\scitek{=}\scitec{1}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteh{""" X ia a vector of the previous state} \\
\sciteh{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} """}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitek{((}\scitel{x0}\scitek{,),(}\scitel{x1}\scitek{,))=}\scitel{x}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitek{((}\scitel{u0}\scitek{,),(}\scitel{u1}\scitek{,))=}\scitel{u}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{ }\scitel{self}\scitek{.}\scitel{h}\scitea{ }\scitek{*}\scitea{ }\scitek{(}\scitel{x0}\scitek{*}\scitel{x0}\scitek{+}\scitel{x1}\scitek{*}\scitel{x1}\scitek{+}\scitel{u0}\scitek{*}\scitel{u0}\scitek{+}\scitel{u1}\scitek{*}\scitel{u1}\scitek{)}\scitea{} \\
\scitea{} \\
\scitef{def}\scitea{ }\scitej{gnuplot}\scitek{(}\scitel{fn}\scitek{,}\scitea{ }\scitek{*}\scitel{args}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\# args are I, X, U, it, \_ (result: Opt, etc.)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{for}\scitea{ }\scitel{i}\scitek{,}\scitea{ }\scitek{(}\scitel{I}\scitek{,}\scitea{ }\scitel{X}\scitek{,}\scitea{ }\scitel{U}\scitek{,}\scitea{ }\scitel{it}\scitek{,}\scitea{ }\scitel{\_}\scitek{)}\scitea{ }\scitef{in}\scitea{ }\scitel{enumerate}\scitek{(}\scitel{args}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{o}\scitek{=}\scitel{open}\scitek{(}\scitel{fn}\scitek{+}\scitel{str}\scitek{(}\scitel{i}\scitek{)+}\scited{".dat"}\scitek{,}\scitea{ }\scited{"w"}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{lx}\scitek{=}\scitel{len}\scitek{(}\scitel{X}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{for}\scitea{ }\scitel{i}\scitek{,}\scitel{x}\scitek{,}\scitel{u}\scitea{ }\scitef{in}\scitea{ }\scitel{zip}\scitek{(}\scitel{range}\scitek{(}\scitel{lx}\scitek{-}\scitec{1}\scitek{),}\scitea{ }\scitel{X}\scitek{[:-}\scitec{1}\scitek{],}\scitel{U}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{t}\scitek{=}\scitel{i}\scitek{/}\scitel{lx}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{o}\scitek{.}\scitel{write}\scitek{(}\scitel{str}\scitek{(}\scitel{t}\scitek{)+}\scited{"{\textbackslash}t"}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{o}\scitek{.}\scitel{write}\scitek{(}\scited{"{\textbackslash}t"}\scitek{.}\scitel{join}\scitek{([}\scitel{str}\scitek{(}\scitel{a}\scitek{)}\scitea{ }\scitef{for}\scitea{ }\scitel{a}\scitea{ }\scitef{in}\scitea{ }\scitel{x}\scitek{]))}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{o}\scitek{.}\scitel{write}\scitek{(}\scited{"{\textbackslash}t"}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{o}\scitek{.}\scitel{write}\scitek{(}\scited{"{\textbackslash}t"}\scitek{.}\scitel{join}\scitek{([}\scitel{str}\scitek{(}\scitel{a}\scitek{)}\scitea{ }\scitef{for}\scitea{ }\scitel{a}\scitea{ }\scitef{in}\scitea{ }\scitel{u}\scitek{]))}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{o}\scitek{.}\scitel{write}\scitek{(}\scited{"{\textbackslash}n"}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{o}\scitek{.}\scitel{close}\scitek{()}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{os}\scitek{.}\scitel{system}\scitek{(}\scitee{'gnuplot test\_with\_plt.p'}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{os}\scitek{.}\scitel{system}\scitek{(}\scitee{'evince my-plot.ps'}\scitek{)}\scitea{} \\
\scitea{} \\
\scitef{def}\scitea{ }\scitej{test2}\scitek{(}\scitel{so}\scitek{=}\scitel{True}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{m}\scitea{ }\scitek{=}\scitea{ }\scitel{LinModel1}\scitek{()}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitef{not}\scitea{ }\scitel{so}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{ip}\scitek{=}\scitel{ParOptProcess}\scitek{(}\scitel{m}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{else}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{ip}\scitek{=}\scitel{SeconOrderParOptProcess}\scitek{(}\scitel{m}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{I}\scitek{,}\scitea{ }\scitel{X}\scitek{,}\scitea{ }\scitel{U}\scitek{,}\scitea{ }\scitel{it}\scitek{,}\scitea{ }\scitel{\_}\scitea{ }\scitek{=}\scitea{ }\scitel{ip}\scitek{.}\scitel{optimize}\scitek{(}\scitel{m}\scitek{.}\scitel{t}\scitek{,}\scitea{ }\scitel{eps}\scitek{=}\scitec{0.001}\scitek{,}\scitea{ }\scitel{iters}\scitek{=}\scitec{2000}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scited{""}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scited{"X,{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} U,{\hspace*{\myspc}}{\hspace*{\myspc}} "}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{for}\scitea{ }\scitel{x}\scitek{,}\scitel{u}\scitea{ }\scitef{in}\scitea{ }\scitel{zip}\scitek{(}\scitel{X}\scitek{,}\scitel{U}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scitel{x}\scitek{,}\scitel{u}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scited{"Result is:"}\scitek{,}\scitea{ }\scitel{I}\scitek{,}\scitea{ }\scited{"in"}\scitek{,}\scitea{ }\scitel{it}\scitek{,}\scitea{ }\scited{"iters"}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scitel{\_}\scitek{)}\scitea{} \\
\scitea{} \\
\scitef{def}\scitea{ }\scitej{test2d}\scitek{(}\scitel{so}\scitek{=}\scitel{False}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{m}\scitea{ }\scitek{=}\scitea{ }\scitel{LinModel2d2du}\scitek{()}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitef{not}\scitea{ }\scitel{so}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{ip}\scitek{=}\scitel{Process}\scitek{(}\scitel{m}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{else}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{ip}\scitek{=}\scitel{SeconOrderProcess}\scitek{(}\scitel{m}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{I}\scitek{,}\scitea{ }\scitel{X}\scitek{,}\scitea{ }\scitel{U}\scitek{,}\scitea{ }\scitel{it}\scitek{,}\scitea{ }\scitel{\_}\scitea{ }\scitek{=}\scitea{ }\scitel{ip}\scitek{.}\scitel{optimize}\scitek{(}\scitel{m}\scitek{.}\scitel{t}\scitek{,}\scitea{ }\scitel{eps}\scitek{=}\scitec{0.001}\scitek{,}\scitea{ }\scitel{iters}\scitek{=}\scitec{200}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scited{""}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scited{"X,{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} U,{\hspace*{\myspc}}{\hspace*{\myspc}} "}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{for}\scitea{ }\scitel{x}\scitek{,}\scitel{u}\scitea{ }\scitef{in}\scitea{ }\scitel{zip}\scitek{(}\scitel{X}\scitek{,}\scitel{U}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scitel{x}\scitek{,}\scitel{u}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scited{"Result is:"}\scitek{,}\scitea{ }\scitel{I}\scitek{,}\scitea{ }\scited{"in"}\scitek{,}\scitea{ }\scitel{it}\scitek{,}\scitea{ }\scited{"iters"}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scitel{\_}\scitek{)}\scitea{} \\
\scitea{} \\
\scitef{def}\scitea{ }\scitej{test\_with\_plot}\scitek{():}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{m}\scitea{ }\scitek{=}\scitea{ }\scitel{LinModel1}\scitek{()}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{p1}\scitek{=}\scitel{Process}\scitek{(}\scitel{m}\scitek{,}\scitea{ }\scitel{beta}\scitek{=}\scitec{1.0}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{p2}\scitek{=}\scitel{SeconOrderProcess}\scitek{(}\scitel{m}\scitek{,}\scitea{ }\scitel{alpha}\scitek{=}\scitec{0.001}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{iters}\scitek{=}\scitec{2000}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{eps}\scitek{=}\scitec{0.001}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scited{"First-order process:"}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scited{"-"}\scitek{*}\scitec{20}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{r1}\scitek{=}\scitel{I1}\scitek{,}\scitea{ }\scitel{X1}\scitek{,}\scitea{ }\scitel{U1}\scitek{,}\scitea{ }\scitel{it1}\scitek{,}\scitea{ }\scitel{\_1}\scitea{ }\scitek{=}\scitea{ }\scitel{p1}\scitek{.}\scitel{optimize}\scitek{(}\scitel{m}\scitek{.}\scitel{t}\scitek{,}\scitea{ }\scitel{eps}\scitek{=}\scitel{eps}\scitek{,}\scitea{ }\scitel{iters}\scitek{=}\scitel{iters}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scitel{I1}\scitek{,}\scitea{ }\scited{"iters:"}\scitek{,}\scitea{ }\scitel{it1}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scited{"Second-order process:"}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scited{"-"}\scitek{*}\scitec{20}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{r2}\scitek{=}\scitel{I2}\scitek{,}\scitea{ }\scitel{X2}\scitek{,}\scitea{ }\scitel{U2}\scitek{,}\scitea{ }\scitel{it2}\scitek{,}\scitea{ }\scitel{\_2}\scitea{ }\scitek{=}\scitea{ }\scitel{p2}\scitek{.}\scitel{optimize}\scitek{(}\scitel{m}\scitek{.}\scitel{t}\scitek{,}\scitea{ }\scitel{eps}\scitek{=}\scitel{eps}\scitek{,}\scitea{ }\scitel{iters}\scitek{=}\scitel{iters}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scitel{I2}\scitek{,}\scitea{ }\scited{"iters:"}\scitek{,}\scitea{ }\scitel{it2}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{gnuplot}\scitek{(}\scited{"test\_with\_plt"}\scitek{,}\scitea{ }\scitel{r1}\scitek{,}\scitel{r2}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#gnuplot("test\_with\_plt", r1)}\scitea{} \\
\scitea{} \\
\scitef{def}\scitea{ }\scitej{test2d1}\scitek{():}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{m}\scitea{ }\scitek{=}\scitea{ }\scitel{LinModel2d2du1}\scitek{()}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{return}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{ip}\scitek{=}\scitel{Process}\scitek{(}\scitel{m}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{I}\scitek{,}\scitea{ }\scitel{X}\scitek{,}\scitea{ }\scitel{U}\scitek{,}\scitea{ }\scitel{it}\scitek{,}\scitea{ }\scitel{\_}\scitea{ }\scitek{=}\scitea{ }\scitel{ip}\scitek{.}\scitel{optimize}\scitek{(}\scitel{m}\scitek{.}\scitel{t}\scitek{,}\scitea{ }\scitel{eps}\scitek{=}\scitec{0.001}\scitek{,}\scitea{ }\scitel{iters}\scitek{=}\scitec{2000}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scited{""}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scited{"X,{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} U,{\hspace*{\myspc}}{\hspace*{\myspc}} "}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{for}\scitea{ }\scitel{x}\scitek{,}\scitel{u}\scitea{ }\scitef{in}\scitea{ }\scitel{zip}\scitek{(}\scitel{X}\scitek{,}\scitel{U}\scitek{):}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scitel{x}\scitek{,}\scitel{u}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scited{"Result is:"}\scitek{,}\scitea{ }\scitel{I}\scitek{,}\scitea{ }\scited{"in"}\scitek{,}\scitea{ }\scitel{it}\scitek{,}\scitea{ }\scited{"iters"}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scitel{\_}\scitek{)}\scitea{} \\
\scitea{} \\
\scitef{def}\scitea{ }\scitej{test\_VFCalc}\scitek{():}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{d}\scitek{=}\scitel{VFCalc}\scitek{(}\scitec{2}\scitek{,}\scitec{2}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{x1}\scitek{,}\scitel{x2}\scitek{=}\scitel{Symbol}\scitek{(}\scitee{'x1'}\scitek{),}\scitel{Symbol}\scitek{(}\scitee{'x2'}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{u1}\scitek{,}\scitel{u2}\scitek{=}\scitel{Symbol}\scitek{(}\scitee{'u1'}\scitek{),}\scitel{Symbol}\scitek{(}\scitee{'u2'}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{y1}\scitek{=}\scitel{x1}\scitek{**}\scitec{2}\scitek{*}\scitel{u1}\scitek{+}\scitel{x2}\scitek{*}\scitel{u2}\scitek{**}\scitec{2}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{y2}\scitek{=}\scitel{x1}\scitek{**}\scitec{2}\scitek{*}\scitel{x2}\scitek{**}\scitec{2}\scitek{*}\scitel{u1}\scitek{**}\scitec{2}\scitek{*}\scitel{u2}\scitek{**}\scitec{2}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{()}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#print (d.diff1([y1,y2],[x1,x2]))}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#print (d.diff1([y1,y2],[u1,u2]))}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#res=(d.diff([y1,y2], [x1,x2], [u1,u2]))}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#pprint (res)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{X1}\scitek{=}\scitel{ones}\scitek{(}\scitec{10}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{X2}\scitek{=}\scitel{X1}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{X2}\scitek{+=}\scitec{1}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{X}\scitek{=}\scitel{ndarray}\scitek{(}\scitel{shape}\scitek{=(}\scitec{10}\scitek{,}\scitec{2}\scitek{),}\scitea{ }\scitel{dtype}\scitek{=}\scitel{float}\scitek{,}\scitea{ }\scitel{order}\scitek{=}\scitee{'F'}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{X}\scitek{[:,}\scitec{0}\scitek{]=}\scitel{X1}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{X}\scitek{[:,}\scitec{1}\scitek{]=}\scitel{X2}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{U1}\scitek{=}\scitel{X1}\scitek{+}\scitec{2}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{U2}\scitek{=}\scitel{U1}\scitek{+}\scitec{4}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{U}\scitek{=}\scitel{ndarray}\scitek{(}\scitel{shape}\scitek{=(}\scitec{10}\scitek{,}\scitec{2}\scitek{),}\scitea{ }\scitel{dtype}\scitek{=}\scitel{float}\scitek{,}\scitea{ }\scitel{order}\scitek{=}\scitee{'F'}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{U}\scitek{[:,}\scitec{0}\scitek{]=}\scitel{U1}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{U}\scitek{[:,}\scitec{1}\scitek{]=}\scitel{U2}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{T}\scitek{=}\scitel{linspace}\scitek{(}\scitel{start}\scitek{=}\scitec{0.0}\scitek{,}\scitea{ }\scitel{stop}\scitek{=}\scitec{1.0}\scitek{,}\scitea{ }\scitel{num}\scitek{=}\scitel{len}\scitek{(}\scitel{X1}\scitek{))}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{fun}\scitek{,}\scitea{ }\scitel{f}\scitek{=}\scitel{d}\scitek{.}\scitel{code}\scitek{([}\scitel{y1}\scitek{,}\scitel{y2}\scitek{],}\scitea{ }\scitek{[}\scitel{x1}\scitek{,}\scitel{x2}\scitek{],[}\scitel{u1}\scitek{,}\scitel{u2}\scitek{],}\scitea{ }\scitel{debug}\scitek{=}\scitel{True}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scitel{fun}\scitek{,}\scitea{ }\scitel{f}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{((}\scitel{T}\scitek{[}\scitec{0}\scitek{],}\scitel{X}\scitek{[}\scitec{0}\scitek{,:],}\scitel{U}\scitek{[}\scitec{0}\scitek{,:]))}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{pprint}\scitea{ }\scitek{(}\scitel{fun}\scitek{(}\scitel{T}\scitek{[}\scitec{0}\scitek{],}\scitel{X}\scitek{[}\scitec{0}\scitek{,:],}\scitel{U}\scitek{[}\scitec{0}\scitek{,:]))}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{quit}\scitek{()}\scitea{} \\
\scitea{} \\
\scitea{} \\
\scitef{if}\scitea{ }\scitel{\_\_name\_\_}\scitek{==}\scited{"\_\_main\_\_"}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#test\_VFCalc()}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#raise SystemExit(0)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{print}\scitea{ }\scitek{(}\scited{"ok"}\scitek{)}\scitea{} \\
\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{TEST}\scitek{=}\scitee{'test\_with\_plot'}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\sciteb{\#TEST='test2d'}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{LOG}\scitek{=}\scitee{'restats.log'}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{if}\scitea{ }\scitel{PROFILE}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{import}\scitea{ }\scitel{cProfile}\scitek{,}\scitea{ }\scitel{pstats}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{cProfile}\scitek{.}\scitel{run}\scitek{(}\scitel{TEST}\scitek{+}\scited{"()"}\scitek{,}\scitea{ }\scitel{LOG}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{p}\scitek{=}\scitel{pstats}\scitek{.}\scitel{Stats}\scitek{(}\scitel{LOG}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{p}\scitek{.}\scitel{strip\_dirs}\scitek{().}\scitel{sort\_stats}\scitek{(}\scitee{'time'}\scitek{,}\scitee{'cumulative'}\scitek{).}\scitel{print\_stats}\scitek{()}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitef{else}\scitek{:}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{eval}\scitek{(}\scitel{TEST}\scitek{+}\scited{"()"}\scitek{)}\scitea{} \\
\scitea{{\hspace*{\myspc}}{\hspace*{\myspc}}{\hspace*{\myspc}} }\scitel{quit}\scitek{()}\scitea{} \\
\scitea{}
} %end small

\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
